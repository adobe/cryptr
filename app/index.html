<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="generator" content="Cryptr">
	<title>Cryptr</title>
	<link rel="stylesheet" href="styles/main.css">
	<script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
	<link rel="import" href="elements/elements.html">
</head>

<body unresolved>
	<template is="dom-bind" id="app">
		<login-form status="{{status}}" username="{{u}}" url="{{url}}" header="{{header}}" initial-response="{{loginResponse}}" page="{{loginPage}}"></login-form>
		<login-status status="{{status}}" url="{{url}}" header="{{header}}"></login-status>
		<secrets-init status="{{status}}" header="{{header}}" login-response="{{loginResponse}}" secrets="{{secrets}}"></secrets-init>

		<paper-drawer-panel id="paperDrawerPanel" drawer-width="170px">
			<!-- Drawer Area -->
			<paper-scroll-header-panel drawer fixed>
				<paper-toolbar id="drawerToolbar" style="-webkit-app-region: drag; padding-top: 15px;">
					<iron-image id="logo" src="images/cryptr-internal.png" preload sizing="cover"></iron-image>
					<span class="menu-name noselect">Cryptr</span>
				</paper-toolbar>

				<span id="drawerMenuText" class="noselect">HOME</span>
				<paper-menu attr-for-selected="data-route" selected="{{route}}">
					<a data-route="home" href="{{baseUrl}}" class="noselect">
						<iron-icon icon="dashboard"></iron-icon>
						<span>Dashboard</span>
					</a>
					<template is="dom-if" if="{{query}}">
						<a data-route="search" href="{{baseUrl}}search" class="noselect">
							<iron-icon icon="search"></iron-icon>
							<span>Search</span>
						</a>
					</template>
				</paper-menu>

				<span id="drawerMenuText" class="noselect">SECRETS</span>
				<!-- <paper-menu attr-for-selected="data-route" selected="[[route]]"> -->
					<folder-structure secrets="[[secrets]]" route="{{route}}" base-url="{{baseUrl}}" base-folder="secret" indent="35"></folder-structure>
				<!-- </paper-menu> -->
			</paper-scroll-header-panel>

			<!-- Main Area -->
			<paper-scroll-header-panel main id="headerPanelMain" fixed>
				<!-- Topbar -->
				<paper-toolbar id="mainToolbar">
					<!-- For future developments -->
					<!-- <refresh-keys></refresh-keys> -->

					<search-box query="{{query}}"></search-box>
					<span class="space"></span>
					<user-info username="{{u}}" url="{{url}}"></user-info>
				</paper-toolbar>

				<!-- Main Content -->
				<div class="content" style="height: 100%">
					<iron-pages attr-for-selected="data-route" selected="{{route}}" style="height: 100%">
						<section data-route="home">
							<paper-material elevation="1">
								<h2 class="page-title">Dashboard</h2>
								<p>Placeholder for future content. This may include keys nearing the end of their 90 day lifespan and recently modified keys. </p>
							</paper-material>
						</section>

						<template is="dom-repeat" items="{{secrets}}">
							<section data-route="{{item.type}}/{{item.location}}" style="height: 100%">
								This is a test: {{item.type}} {{item.name}}
							</section>
						</template>
					</iron-pages>
				</div>
			</paper-scroll-header-panel>
		</paper-drawer-panel>

		<paper-toast id="toast">
			<span class="toast-hide-button" role="button" tabindex="0" onclick="app.$.toast.hide()">Ok</span>
		</paper-toast>

	</template>

	<script src="scripts/app.js"></script>
	<script src="scripts/hcltojson.js"></script>
	<script>
		const clipboard = require('electron').clipboard;
		const ipcRenderer = require('electron').ipcRenderer;
		app.url = 'start';
		ipcRenderer.on('url', function(event, arg) {
			app.url = arg;
		});
		ipcRenderer.on('user', function(event, arg) {
			app.u = arg;
			// Set cursor autofocus for login/password fields
			if (app.u == '') document.getElementById('userfield').autofocus = true;
			else document.getElementById('passfield').autofocus = true;
		});
		ipcRenderer.on('prevpass', function(event, arg) { app.prevPassword = arg; });
		ipcRenderer.on('loginpage', function(event, arg) { app.loginPage = arg; });
		ipcRenderer.send('initialized', 'ping');
	</script>
</body>
</html>
