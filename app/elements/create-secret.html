<dom-module id="create-secret">
	<style>

	</style>
	<template>
		<iron-ajax id="getSecret"
			url="{{secretURL}}"
			handle-as="json"
			headers="{{header}}"
			on-error="_getError"
			on-response="_getSuccess"
			last-response="{{response}}">
		</iron-ajax>

		<iron-ajax id="createSecret"
			url="{{secretURL}}"
			method="post"
			body="{{body}}"
			handle-as="json"
			content-type="application/json"
			headers="{{header}}"
			on-error="_createError"
			on-response="_createSuccess"
			last-response="{{response}}">
		</iron-ajax>
		CREATE SECRET
		<paper-material elevation="1">
			<paper-input label="Location" value="{{location}}"></paper-input>
			<paper-input label="Value" value="{{stringValue}}"></paper-input>
			<paper-button on-tap="createSecret">Submit</paper-button>
		</paper-material>

	</template>


	<script>
		Polymer({
			is: "create-secret",
			properties: {
				secrets: Object,
				header: String,
				location: {
					type: String,
					value: '',
					observer: 'watchLocation'
				},
				stringValue: {
					type: String,
					value: '',
					observer: 'parseString'
				}
			},
			watchLocation: function() {
				this.secretURL = app.url + 'v1/' + this.location;
				this.debounce('checkLocation', function () {
					this.$.getSecret.generateRequest();
					// Create more feedback here
				}, 500);
			},
			_createError: function(e) {
				console.log('ERROR', e);
			},
			_createSuccess: function(e) {
				console.log('SUCCESS', e);
			},
			_getError: function(e) {
				// Todo: Show the user a positive signal that the secret location contains no secret already
			},
			_getSuccess: function(e) {
				console.log('SUCCESS', e);
				// Todo: Alert the user that this secret already exists, and they have access
			},
			createSecret: function() {
				this.$.createSecret.generateRequest();
				this.stringValue = '';
			},
			parseString: function() {
				this.body = {value: this.stringValue};
			}
		});
	</script>
</dom-module>